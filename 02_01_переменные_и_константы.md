# Переменные и константы в Rust

## Введение

В Rust переменные и константы являются фундаментальными элементами языка, которые позволяют хранить и манипулировать данными. Однако, в отличие от многих других языков программирования, Rust имеет уникальный подход к работе с переменными, который тесно связан с его системой владения (ownership) и безопасности памяти.

В этой главе мы рассмотрим:
- Неизменяемые переменные (immutable)
- Изменяемые переменные (mutable)
- Затенение переменных (shadowing)
- Константы (const)
- Статические переменные (static)

## Неизменяемые переменные

В Rust переменные **по умолчанию неизменяемы (immutable)**. Это означает, что после присвоения значения переменной, это значение нельзя изменить. Такой подход способствует написанию безопасного кода, предотвращая случайные изменения данных.

```rust
fn main() {
    let x = 5;
    println!("Значение x: {}", x);
    
    // Следующая строка вызовет ошибку компиляции
    // x = 6; // error[E0384]: cannot assign twice to immutable variable `x`
}
```

Если вы попытаетесь изменить значение неизменяемой переменной, компилятор выдаст ошибку. Это одна из особенностей Rust, которая помогает предотвратить множество распространенных ошибок на этапе компиляции.

## Изменяемые переменные

Если вам нужно изменять значение переменной, вы можете сделать её изменяемой (mutable), добавив ключевое слово `mut` при объявлении:

```rust
fn main() {
    let mut x = 5;
    println!("Значение x: {}", x);
    
    x = 6; // Теперь это допустимо
    println!("Новое значение x: {}", x);
}
```

Использование `mut` явно указывает, что значение переменной будет изменяться. Это делает код более читаемым и помогает другим разработчикам понять ваши намерения.

## Затенение переменных (Shadowing)

Rust позволяет объявлять новую переменную с тем же именем, что и существующая. Это называется **затенением (shadowing)**. Новая переменная "затеняет" предыдущую, что означает, что все последующие обращения к этому имени будут использовать новую переменную.

```rust
fn main() {
    let x = 5;
    println!("Первое значение x: {}", x);
    
    let x = x + 1; // Создаем новую переменную x, которая затеняет предыдущую
    println!("Второе значение x: {}", x);
    
    {
        let x = x * 2; // Затенение в новой области видимости
        println!("Значение x во внутренней области: {}", x);
    }
    
    println!("Значение x во внешней области: {}", x);
}
```

Вывод программы:
```
Первое значение x: 5
Второе значение x: 6
Значение x во внутренней области: 12
Значение x во внешней области: 6
```

Затенение отличается от изменения переменной с помощью `mut` несколькими важными аспектами:

1. Мы можем изменить тип переменной при затенении, сохраняя то же имя:

```rust
fn main() {
    let spaces = "   "; // строковый тип
    println!("Строка из пробелов: '{}'", spaces);
    
    let spaces = spaces.len(); // числовой тип
    println!("Количество пробелов: {}", spaces);
}
```

2. Мы создаем новую переменную, а не изменяем существующую, что важно с точки зрения системы владения Rust.

3. Затенение сохраняет неизменяемость, что может быть предпочтительнее в некоторых случаях.

## Константы

**Константы (constants)** в Rust объявляются с помощью ключевого слова `const` и всегда неизменяемы (ключевое слово `mut` с ними использовать нельзя). Они должны иметь явно указанный тип и значение, которое может быть вычислено на этапе компиляции.

```rust
const MAX_POINTS: u32 = 100_000;

fn main() {
    println!("Максимальное количество очков: {}", MAX_POINTS);
}
```

Особенности констант:

1. Константы могут быть объявлены в любой области видимости, включая глобальную.
2. Значение константы должно быть известно на этапе компиляции, поэтому вы не можете использовать результат функции или любое другое значение, которое может быть определено только во время выполнения.
3. Константы действуют в течение всего времени выполнения программы в области, где они объявлены.
4. По соглашению, имена констант пишутся в ВЕРХНЕМ_РЕГИСТРЕ_С_ПОДЧЕРКИВАНИЯМИ.

## Статические переменные

**Статические переменные (static variables)** похожи на константы, но имеют несколько важных отличий. Они объявляются с помощью ключевого слова `static`:

```rust
static LANGUAGE: &str = "Rust";

fn main() {
    println!("Я изучаю {}", LANGUAGE);
}
```

Особенности статических переменных:

1. Статические переменные имеют фиксированный адрес в памяти и существуют в течение всего времени выполнения программы.
2. Они могут быть изменяемыми с помощью `mut`, но доступ к изменяемым статическим переменным считается небезопасным (unsafe) и требует использования блока `unsafe`:

```rust
static mut COUNTER: u32 = 0;

fn main() {
    unsafe {
        COUNTER += 1;
        println!("Счетчик: {}", COUNTER);
    }
}
```

3. Статические переменные могут иметь "время жизни" `'static`, что означает, что они существуют в течение всего времени выполнения программы.

## Сравнение различных способов объявления переменных

| Особенность | Неизменяемая переменная | Изменяемая переменная | Затенение | Константа | Статическая переменная |
|-------------|-------------------------|----------------------|-----------|-----------|------------------------|
| Синтаксис | `let x = 5;` | `let mut x = 5;` | `let x = 5; let x = 10;` | `const X: i32 = 5;` | `static X: i32 = 5;` |
| Изменяемость | Нет | Да | Нет (создается новая) | Нет | Возможна (unsafe) |
| Время вычисления | Во время выполнения | Во время выполнения | Во время выполнения | Во время компиляции | Во время компиляции |
| Область видимости | Блок | Блок | Блок | Глобальная/Блок | Глобальная |
| Изменение типа | Нет | Нет | Да | Нет | Нет |
| Время жизни | До конца области видимости | До конца области видимости | До конца области видимости | Всё время компиляции | Всё время выполнения |

## Примеры использования

### Пример 1: Работа с неизменяемыми и изменяемыми переменными

```rust
fn main() {
    // Неизменяемая переменная
    let name = "Alice";
    println!("Имя: {}", name);
    
    // Изменяемая переменная
    let mut age = 30;
    println!("Возраст: {}", age);
    
    age = 31; // Изменяем значение
    println!("Новый возраст: {}", age);
    
    // Следующая строка вызовет ошибку компиляции
    // name = "Bob"; // error: cannot assign twice to immutable variable
}
```

### Пример 2: Затенение переменных

```rust
fn main() {
    // Преобразование ввода пользователя
    let user_input = "  42  ";
    let user_input = user_input.trim(); // Затеняем, чтобы удалить пробелы
    
    // Преобразуем строку в число
    let user_input: u32 = user_input.parse().expect("Не удалось преобразовать в число");
    
    println!("Введенное число: {}", user_input);
    println!("Число + 10: {}", user_input + 10);
}
```

### Пример 3: Использование констант

```rust
const PI: f64 = 3.14159;
const EARTH_RADIUS_KM: f64 = 6371.0;

fn main() {
    let distance = 2.0 * PI * EARTH_RADIUS_KM;
    println!("Длина экватора Земли: {:.2} км", distance);
}
```

### Пример 4: Статические переменные

```rust
static APP_NAME: &str = "Rust Calculator";
static APP_VERSION: &str = "1.0.0";

fn main() {
    println!("Приложение: {} v{}", APP_NAME, APP_VERSION);
    
    print_app_info();
}

fn print_app_info() {
    // Статические переменные доступны во всех функциях
    println!("Информация о приложении:");
    println!("  Название: {}", APP_NAME);
    println!("  Версия: {}", APP_VERSION);
}
```

## Лучшие практики

1. **Предпочитайте неизменяемость**: Используйте неизменяемые переменные по умолчанию и добавляйте `mut` только когда это действительно необходимо.

2. **Используйте затенение для преобразований**: Когда вам нужно преобразовать переменную или изменить её тип, используйте затенение вместо создания новых переменных с разными именами.

3. **Константы для магических чисел**: Используйте константы вместо "магических чисел" в коде для улучшения читаемости и поддерживаемости.

4. **Соглашения об именовании**:
   - Переменные и функции: `snake_case` (все буквы строчные, слова разделены подчеркиваниями)
   - Константы и статические переменные: `SCREAMING_SNAKE_CASE` (все буквы заглавные, слова разделены подчеркиваниями)

5. **Избегайте изменяемых статических переменных**: Они требуют использования `unsafe` и могут привести к проблемам с безопасностью и многопоточностью.

## Упражнения

1. **Базовое использование переменных**:
   Создайте программу, которая объявляет неизменяемую переменную с вашим именем и изменяемую переменную с вашим возрастом. Увеличьте возраст на 1 и выведите обе переменные.

2. **Затенение переменных**:
   Напишите программу, которая использует затенение для преобразования строки "10.5" в число с плавающей точкой, а затем округляет его до целого числа.

3. **Работа с константами**:
   Создайте программу для расчета площади круга. Объявите константу PI и используйте её в формуле площади (π * r²).

4. **Сравнение подходов**:
   Напишите программу, которая демонстрирует разницу между изменяемой переменной и затенением. Создайте переменную-счетчик двумя способами и увеличьте её значение несколько раз.

## Заключение

Понимание переменных и констант в Rust является фундаментальным для эффективного использования языка. Неизменяемость по умолчанию, возможность затенения и четкое разделение между различными типами переменных помогают писать более безопасный и понятный код.

В следующей главе мы рассмотрим базовые типы данных в Rust и как они взаимодействуют с системой переменных, которую мы только что изучили.